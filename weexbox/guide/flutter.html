<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flutter 初体验 | WeexBox 2.0</title>
    <meta name="description" content="一套简洁高效的APP混合开发解决方案">
    <link rel="icon" href="/weexbox/logo.png">
  <link rel="manifest" href="/weexbox/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/weexbox/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/weexbox/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/weexbox/assets/css/0.styles.ec3e2dfe.css" as="style"><link rel="preload" href="/weexbox/assets/js/app.7ae12184.js" as="script"><link rel="preload" href="/weexbox/assets/js/2.52705d15.js" as="script"><link rel="preload" href="/weexbox/assets/js/3.9ad135ec.js" as="script"><link rel="prefetch" href="/weexbox/assets/js/10.a7169dbc.js"><link rel="prefetch" href="/weexbox/assets/js/11.9742484b.js"><link rel="prefetch" href="/weexbox/assets/js/12.10489b0a.js"><link rel="prefetch" href="/weexbox/assets/js/13.cabed5b5.js"><link rel="prefetch" href="/weexbox/assets/js/14.6c8f5b6b.js"><link rel="prefetch" href="/weexbox/assets/js/15.1b59ec5b.js"><link rel="prefetch" href="/weexbox/assets/js/16.1318a363.js"><link rel="prefetch" href="/weexbox/assets/js/17.1bd8f75e.js"><link rel="prefetch" href="/weexbox/assets/js/18.66174097.js"><link rel="prefetch" href="/weexbox/assets/js/19.ae785245.js"><link rel="prefetch" href="/weexbox/assets/js/20.0036fd31.js"><link rel="prefetch" href="/weexbox/assets/js/21.173059ca.js"><link rel="prefetch" href="/weexbox/assets/js/22.099c6ff1.js"><link rel="prefetch" href="/weexbox/assets/js/23.c9bc06d2.js"><link rel="prefetch" href="/weexbox/assets/js/24.153c96fa.js"><link rel="prefetch" href="/weexbox/assets/js/25.7e5c66d8.js"><link rel="prefetch" href="/weexbox/assets/js/4.24da341f.js"><link rel="prefetch" href="/weexbox/assets/js/5.31ab48fc.js"><link rel="prefetch" href="/weexbox/assets/js/6.ea13dfb9.js"><link rel="prefetch" href="/weexbox/assets/js/7.ef256c9d.js"><link rel="prefetch" href="/weexbox/assets/js/8.35e88af2.js"><link rel="prefetch" href="/weexbox/assets/js/9.b5bf424f.js">
    <link rel="stylesheet" href="/weexbox/assets/css/0.styles.ec3e2dfe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weexbox/" class="home-link router-link-active"><!----> <span class="site-name">WeexBox 2.0</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/weexbox/guide/" class="nav-link router-link-active">指南</a></div> <a href="https://github.com/aygtech/aygtech.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/weexbox/guide/" class="nav-link router-link-active">指南</a></div> <a href="https://github.com/aygtech/aygtech.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weexbox/guide/" class="sidebar-link">介绍</a></li><li><a href="/weexbox/guide/getting-started.html" class="sidebar-link">开发环境</a></li><li><a href="/weexbox/guide/hello-world.html" class="sidebar-link">Hello World</a></li><li><a href="/weexbox/guide/flutter.html" class="active sidebar-link">Flutter 初体验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weexbox/guide/flutter.html#为何使用" class="sidebar-link">为何使用</a></li><li class="sidebar-sub-header"><a href="/weexbox/guide/flutter.html#weexbox中使用flutter" class="sidebar-link">weexBox中使用flutter</a></li><li class="sidebar-sub-header"><a href="/weexbox/guide/flutter.html#混合开发" class="sidebar-link">混合开发</a></li><li class="sidebar-sub-header"><a href="/weexbox/guide/flutter.html#原生通信" class="sidebar-link">原生通信</a></li><li class="sidebar-sub-header"><a href="/weexbox/guide/flutter.html#weex通信" class="sidebar-link">weex通信</a></li></ul></li><li><a href="/weexbox/guide/project.html" class="sidebar-link">项目结构</a></li><li><a href="/weexbox/guide/native-ios.html" class="sidebar-link">iOS 集成 WeexBox</a></li><li><a href="/weexbox/guide/native-android.html" class="sidebar-link">Android 集成 WeexBox</a></li><li><a href="/weexbox/guide/assets.html" class="sidebar-link">静态资源</a></li><li><a href="/weexbox/guide/component.html" class="sidebar-link">Component 拓展</a></li><li><a href="/weexbox/guide/module.html" class="sidebar-link">Module 拓展</a></li><li><a href="/weexbox/guide/eslint.html" class="sidebar-link">JS代码规范</a></li><li><a href="/weexbox/guide/migrate.html" class="sidebar-link">1.0迁移到2.0指引</a></li><li><a href="/weexbox/guide/change-log.html" class="sidebar-link">Change Log</a></li><li><a href="/weexbox/guide/who-s-using.html" class="sidebar-link">谁在使用 WeexBox</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="flutter-初体验"><a href="#flutter-初体验" aria-hidden="true" class="header-anchor">#</a> Flutter 初体验</h1> <h2 id="为何使用"><a href="#为何使用" aria-hidden="true" class="header-anchor">#</a> 为何使用</h2> <h3 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h3> <p>针对原生开发面临的问题，人们一直都在努力寻找好的解决方案，时至今日，已经有很多跨平台框架(主要指Android和iOS两个平台)，根据其原理，主要分为三类：</p> <ul><li>H5+原生（Cordova、Ionic、微信小程序）</li> <li>JavaScript开发 + 原生渲染 （React Native、Weex）</li> <li>自绘UI+原生(Flutter)</li></ul> <p>针对以上几种跨平台的方案，每个框架都有其优缺点，在我们的项目中，也都曾尝试过，也踩过无数的坑。近期爱收入开发天团初体验了flutter并成功上线，发现了它的美，迫不及待地分享给大家。</p> <h3 id="weex的不足"><a href="#weex的不足" aria-hidden="true" class="header-anchor">#</a> weex的不足</h3> <ul><li>学习资料少</li></ul> <blockquote><p>Weex 的学习资料比较少。而RN使用的开发者比较多, 社区活跃，围绕react产生了许多开发框架。
这一点，个人认为是weex最大的缺点，甚至是weex能不能很好发展下去的关键因素.</p></blockquote> <ul><li>社区活跃度不够</li></ul> <blockquote><p>Weex 相较于 RN 起步比较晚，Weex目前社区主要由阿里人员在维护, 相较于已经成熟的RN社区目前还有很多不足。用的人相对RN少很多，目前没有形成一个良好的生态。作为开发者，如果碰到一个问题，搜索不到，抛出去也没人很好的解答，自己摸索的成本就会很高了。 可能解决一个问题的成本就已经远远大于节省下来的一点学习成本。</p></blockquote> <ul><li>界面的设配精度不够</li></ul> <blockquote><p>Weex进行界面适配的时候是用750为标准的，所以需要根据750去换算，换算的过程中会进行四舍五入，所以会产生精度不足。</p></blockquote> <ul><li>对常用的断点调试支持不足</li> <li>不支持热重载</li> <li>官方对于动画的支持非常薄弱</li> <li>weex每次更新都会出现较严重的设配问题</li></ul> <h3 id="flutter优点"><a href="#flutter优点" aria-hidden="true" class="header-anchor">#</a> Flutter优点</h3> <ol><li>性能强大，流畅</li></ol> <blockquote><p>Flutter对比weex和react native相比，性能的强大是有目共睹的。对于weex，react native，主要基于dom树渲染原生组件，很难与直接在原生视图上绘图比肩性能，Google作为一个轮子大厂，直接在两个平台上重写了各自的UIKit，对接到平台底层，减少UI层的多层转换，UI性能可以比肩原生，这个优势在滑动和播放动画时尤为明显。</p></blockquote> <ol start="2"><li>路由设计优秀。</li></ol> <blockquote><p>Flutter的路由传值非常方便，push一个路由，会返回一个Future对象（也就是Promise对象），使用await或者.then就可以在目标路由pop，回到当前页面时收到返回值。这个反向传值的设计基本是甩了微信小程序一条街了。弹出dialog等一些操作也是使用的路由方法，几乎不用担心出现传值困难</p></blockquote> <ol start="3"><li>优秀的动画设计。</li></ol> <blockquote><p>Flutter的动画简单到不可思议，动画对象会根据屏幕刷新率每秒产生很多个（一般是60个）浮点数，只需要将一个组件属性通过补间（Tween）关联到动画对象上，Flutter会确保在每一帧渲染正确的组件，从而形成连贯的动画。这种十分暴力的操作在Flutter上却看不到明显的卡顿，这也是Flutter的一个魔力所在。相比之下其他跨平台框架几乎不能设计动画……往往会遭遇非常严重的性能问题。</p></blockquote> <ol start="4"><li>UI跨平台稳定。</li></ol> <blockquote><p>Google直接在两个平台上在底层重写了UIKit，不依赖于Css等外部解释器，几乎不存在UI表达不理想，渲染不正常的情况，可以获得非常稳定的UI表达效果。Css换个浏览器就有不同的表现，基于Css的跨平台框架很难获得稳定的UI表现。</p></blockquote> <ol start="5"><li>可选静态的语言，语言特性优秀</li></ol> <blockquote><p>Dart是一个静态语言，这也是相对于js的一个优势。Dart可以被编译成js，但是看起来更像java。静态语言可以避免错误，获得更多的编辑器提示词，极大的增加可维护性。很多js库也已经用ts重写了，Vue3.0的底层也将全部使用ts编写，静态语言的优势不言而喻。</p></blockquote> <ol start="6"><li>支持热重载</li></ol> <ul><li><a href="https://www.jianshu.com/p/c51fc925bfd1" target="_blank" rel="noopener noreferrer">引用地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="flutter架构简介"><a href="#flutter架构简介" aria-hidden="true" class="header-anchor">#</a> Flutter架构简介</h3> <ul><li>传统的原生开发使用Native语言和Platform进行交互，通过调用平台API来实现App的功能。</li></ul> <img src="/weexbox/assets/img/flutter_0_1.ee8a5253.png"> <ul><li>RN通过JS访问平台UI组件，所以需要通过Bridge桥接器将JS转换到原生，在UI被频繁操作时可能导致性能问题。</li></ul> <img src="/weexbox/assets/img/flutter_0_2.ff7afca9.png"> <ul><li>为避免JS桥接器的性能问题，Flutter采用Dart语言，Dart使用预编译的方式编译多个平台的原生代码，这允许Flutter直接与平台通信，而不需要通过执行上下文切换的JS桥接器。Flutter的UI组件和渲染器都从平台中移到了到用户的应用程序，所以虚拟机中的控件树是真实的控件树，渲染速度快。Dart程序和执行数据编解码的平台之间仍然有个接口，但这个接口的速度比JSBridge高出几个数量级。</li></ul> <img src="/weexbox/assets/img/flutter_0_3.f55c0ddc.png"> <ul><li>绘制原理</li></ul> <blockquote><p>我们都知道显示器以固定的频率刷新，比如 iPhone的 60Hz、iPad Pro的 120Hz。当一帧图像绘制完毕后准备绘制下一帧时，显示器会发出一个垂直同步信号（VSync），所以 60Hz的屏幕就会一秒内发出 60次这样的信号。 并且一般地来说，计算机系统中，CPU、GPU和显示器以一种特定的方式协作：CPU将计算好的显示内容提交给 GPU，GPU渲染后放入帧缓冲区，然后视频控制器按照 VSync信号从帧缓冲区取帧数据传递给显示器显示。
所以，Android、iOS的 App在显示 UI时是如此，Flutter也不例外，也遵循了这种模式。所以从这里可以看出 Flutter和 React-Native之众的本质区别：React-Native之类只是扩展调用 OEM组件，而 Flutter是自己渲染。 在 Flutter Architecture的解释中，Google还提供了一张更为详尽的图来解释 Flutter的原理：</p></blockquote> <img src="/weexbox/assets/img/flutter_0_4.6e4b8e02.png"> <blockquote><p>这张图解释得更清晰一些：Flutter只关心向 GPU提供视图数据，GPU的 VSync信号同步到 UI线程，UI线程使用 Dart来构建抽象的视图结构，这份数据结构在 GPU线程进行图层合成，视图数据提供给 Skia引擎渲染为 GPU数据，这些数据通过 OpenGL或者 Vulkan提供给 GPU。
所以 Flutter并不关心显示器、视频控制器以及 GPU具体工作，它只关心 GPU发出的 VSync信号，尽可能快地在两个 VSync信号之间计算并合成视图数据，并且把数据提供给 GPU。</p></blockquote> <h3 id="各框架特点汇总"><a href="#各框架特点汇总" aria-hidden="true" class="header-anchor">#</a> 各框架特点汇总</h3> <table><thead><tr><th>比较内容</th> <th style="text-align:center;">React Native</th> <th style="text-align:right;">Weex</th> <th style="text-align:right;">Flutter</th></tr></thead> <tbody><tr><td>平台实现</td> <td style="text-align:center;">JavaScript</td> <td style="text-align:right;">JavaScript</td> <td style="text-align:right;">无桥接、原生编码</td></tr> <tr><td>引擎</td> <td style="text-align:center;">JS V8</td> <td style="text-align:right;">JSCore</td> <td style="text-align:right;">Flutter engine</td></tr> <tr><td>核心语言</td> <td style="text-align:center;">React</td> <td style="text-align:right;">Vue</td> <td style="text-align:right;">Dart</td></tr> <tr><td>Apk大小</td> <td style="text-align:center;">7.6M</td> <td style="text-align:right;">10.6M</td> <td style="text-align:right;">8.1M</td></tr> <tr><td>bundle文件大小</td> <td style="text-align:center;">默认单一，较大</td> <td style="text-align:right;">较小，多页面可多文件</td> <td style="text-align:right;">一般</td></tr> <tr><td>上手难度</td> <td style="text-align:center;">稍高</td> <td style="text-align:right;">容易</td> <td style="text-align:right;">一般</td></tr> <tr><td>架构程度</td> <td style="text-align:center;">较重</td> <td style="text-align:right;">较轻</td> <td style="text-align:right;">重</td></tr> <tr><td>特点</td> <td style="text-align:center;">适合开发整体App</td> <td style="text-align:right;">适合单页面</td> <td style="text-align:right;">适合开发整体App</td></tr> <tr><td>社区</td> <td style="text-align:center;">丰富，facebook重点维护</td> <td style="text-align:right;">有点残念，托管apache</td> <td style="text-align:right;">刚出道的小鲜肉，拥护者众多</td></tr> <tr><td>支持</td> <td style="text-align:center;">Android,iOS</td> <td style="text-align:right;">Android,iOS</td> <td style="text-align:right;">Android,iOS,web?</td></tr></tbody></table> <h2 id="weexbox中使用flutter"><a href="#weexbox中使用flutter" aria-hidden="true" class="header-anchor">#</a> weexBox中使用flutter</h2> <h3 id="安装环境"><a href="#安装环境" aria-hidden="true" class="header-anchor">#</a> 安装环境</h3> <ul><li><a href="https://flutter.dev/docs/get-started/install" target="_blank" rel="noopener noreferrer">flutter SDK安装<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>根据flutter官网配置环境变量</li></ul> <h3 id="创建项目"><a href="#创建项目" aria-hidden="true" class="header-anchor">#</a> 创建项目</h3> <ul><li>weexBox可以通过命令行创建包含weex与flutter的混合项目：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 新建一个weex和flutter混合工程</span>
weexbox create project-name -f
</code></pre></div><h4 id="注意："><a href="#注意：" aria-hidden="true" class="header-anchor">#</a> 注意：</h4> <ul><li>flutter章节是基于Android studio开发环境所写</li></ul> <h3 id="运行项目"><a href="#运行项目" aria-hidden="true" class="header-anchor">#</a> 运行项目</h3> <p>运行项目之前，需要先用Android Studio打开flutter_module项目，该项目在platforms文件夹下，与Android、ios项目同级。因为原生项目需要将flutter文件打包到apk里面，需要先确保flutter项目环境没有问题。打开flutter_module项目后配置好flutter与dart安装路径，如下图：</p> <ul><li>flutter sdk
<img src="/weexbox/assets/img/flutter sdk.c1fffecb.png"></li> <li>dart sdk
<img src="/weexbox/assets/img/dart_sdk.fccc1f7f.png">
然后同步环境后运行该项目，编译一段时间后，生成apk成功（注意apk生成成功，不成功说明你的flutter环境有问题，请检查是否缺少了某个步骤），安装apk成功后，打开apk，Console将会报错，因为该flutter项目并不是一个纯项目，而是我们原生项目的一个依赖。接下来就可以直接运行原生项目。</li> <li>项目结构
<table><thead><tr><th>目录与文件</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td>android</td> <td style="text-align:center;">flutter与Android工程相关</td></tr> <tr><td>ios</td> <td style="text-align:center;">flutter与iOS工程相关</td></tr> <tr><td>lib</td> <td style="text-align:center;">flutter核心代码</td></tr> <tr><td>pubspec.yaml</td> <td style="text-align:center;">flutter依赖的配置文件</td></tr></tbody></table></li></ul> <img src="/weexbox/assets/img/flutter1.ab9c5508.png"> <ul><li>配置文件 pubspec.yaml</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>version<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token comment">// 环境，flutter的sdk版本在此之间</span>
environment<span class="token punctuation">:</span>
  sdk<span class="token punctuation">:</span> <span class="token string">&quot;&gt;=2.2.2 &lt;3.0.0&quot;</span>
<span class="token comment">// 依赖库  </span>
dependencies<span class="token punctuation">:</span>
  flutter<span class="token punctuation">:</span>
    sdk<span class="token punctuation">:</span> flutter
  cupertino_icons<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">0.1</span><span class="token number">.2</span>
  flutter_spinkit<span class="token punctuation">:</span> <span class="token string">&quot;^3.1.0&quot;</span>
  flutter_easyrefresh<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">1.2</span><span class="token number">.7</span>
  common_utils<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">1.1</span><span class="token number">.3</span>
<span class="token comment">// 测试环境的依赖库</span>
dev_dependencies<span class="token punctuation">:</span>
  flutter_test<span class="token punctuation">:</span>
    sdk<span class="token punctuation">:</span> flutter
flutter<span class="token punctuation">:</span>
  uses<span class="token operator">-</span>material<span class="token operator">-</span>design<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token comment">// 图片配置 weexbox refimg / weexbox refimg -d (自动创建基于配置信息的dart文件) 已实现自动导入图片配置</span>
  assets<span class="token punctuation">:</span>
     <span class="token operator">-</span> images<span class="token operator">/</span>icon_expert_help_1<span class="token punctuation">.</span>png
     <span class="token operator">-</span> images<span class="token operator">/</span>icon_expert_help_2<span class="token punctuation">.</span>png
     <span class="token operator">-</span> images<span class="token operator">/</span>icon_expert_help_3<span class="token punctuation">.</span>png
</code></pre></div><h2 id="混合开发"><a href="#混合开发" aria-hidden="true" class="header-anchor">#</a> 混合开发</h2> <h4 id="一-集成到已有的android项目-文档"><a href="#一-集成到已有的android项目-文档" aria-hidden="true" class="header-anchor">#</a> 一. 集成到已有的Android项目  <a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <ol><li>创建module</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>cd some<span class="token operator">/</span>path<span class="token operator">/</span>

flutter create <span class="token operator">-</span>t module <span class="token operator">--</span>org com<span class="token punctuation">.</span>example my_flutter
</code></pre></div><ol start="2"><li>主build.gradle加入</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>android <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  compileOptions <span class="token punctuation">{</span>
    sourceCompatibility <span class="token number">1.8</span>
    targetCompatibility <span class="token number">1.8</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>创建aar包</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>$ cd some<span class="token operator">/</span>path<span class="token operator">/</span>my_flutter
$ flutter build aar
</code></pre></div><ol start="4"><li>在app/build.gradle中加入</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// MyApp/app/build.gradle</span>
android <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

repositories <span class="token punctuation">{</span>
  maven <span class="token punctuation">{</span>
    url <span class="token string">'some/path/my_flutter/build/host/outputs/repo'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">releaseCompile</span> <span class="token punctuation">(</span><span class="token string">'com.example.my_flutter:flutter_release:1.0@aar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transitive <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>settings.gradle中加入：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// MyApp/settings.gradle</span>
include <span class="token string">':app'</span>                                     <span class="token comment">// assumed existing content</span>
<span class="token function">setBinding</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token punctuation">[</span>gradle<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                 <span class="token comment">// new</span>
<span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>                                                      <span class="token comment">// new</span>
  settingsDir<span class="token punctuation">.</span>parentFile<span class="token punctuation">,</span>                                               <span class="token comment">// new</span>
  <span class="token string">'my_flutter/.android/include_flutter.groovy'</span>                          <span class="token comment">// new</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>  
</code></pre></div><ol start="6"><li>最后在app/build.gradle中加入依赖</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>dependencies <span class="token punctuation">{</span>
  implementation <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':flutter'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="二-集成到已有的ios项目-文档"><a href="#二-集成到已有的ios项目-文档" aria-hidden="true" class="header-anchor">#</a> 二. 集成到已有的iOS项目  <a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <h2 id="原生通信"><a href="#原生通信" aria-hidden="true" class="header-anchor">#</a> 原生通信</h2> <ul><li><p>核心类</p> <table><thead><tr><th>类名</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td>BasicMessageChannel</td> <td style="text-align:center;">用于传递数据。Flutter与原生项目的资源是不共享的，可以通过BasicMessageChannel来获取Native项目的图标等资源。</td></tr> <tr><td>MethodChannel</td> <td style="text-align:center;">传递方法调用。Flutter主动调用Native的方法，并获取相应的返回值。比如获取系统电量，发起Toast等调用系统API，可以通过这个来完成。</td></tr> <tr><td>EventChannel</td> <td style="text-align:center;">传递事件。这里是Native将事件通知到Flutter。比如Flutter需要监听网络情况，这时候MethodChannel就无法胜任这个需求了。EventChannel可以将Flutter的一个监听交给Native，Native去做网络广播的监听，当收到广播后借助EventChannel调用Flutter注册的监听，完成对Flutter的事件通知</td></tr></tbody></table></li> <li><p>BasicMessageChannel</p></li></ul> <img src="/weexbox/assets/img/flutter_bmc_1.d43bf5e2.gif"> <img src="/weexbox/assets/img/flutter_bmc_2.b62a928e.gif"> <ul><li>EventChannel</li></ul> <img src="/weexbox/assets/img/flutter_ecl_1.a12b8147.gif"> <img src="/weexbox/assets/img/flutter_ecl_2.5ef59740.gif"> <ul><li>MethodChannel</li></ul> <img src="/weexbox/assets/img/flutter_mcl_1.e00959fe.gif"> <img src="/weexbox/assets/img/flutter_mcl_2.c1f037bf.gif"> <h2 id="weex通信"><a href="#weex通信" aria-hidden="true" class="header-anchor">#</a> weex通信</h2> <p>由于已有项目中使用了weex，为了统一weex，flutter，native三端的通信，我们提供了以下解决方案。
<img src="/weexbox/assets/img/flutter2.3046387b.png"></p> <ul><li>路由的跳转</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'flutter'</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'home'</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span>navBarHidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'push'</span><span class="token punctuation">;</span>
  <span class="token function">MethodConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span>native_open_page<span class="token punctuation">,</span> router<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Event</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 发送事件</span>
  <span class="token function">Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token string">&quot;eventName&quot;</span><span class="token punctuation">,</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册事件</span>
  Event<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">receiveEvent</span><span class="token punctuation">(</span><span class="token string">&quot;eventName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 移除事件</span>
  Event<span class="token punctuation">.</span><span class="token function">unReceiveEvent</span><span class="token punctuation">(</span><span class="token string">&quot;eventName&quot;</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/aygtech/aygtech.github.io/edit/master/docs/guide/flutter.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2019/8/22 下午3:40:06</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/weexbox/guide/hello-world.html" class="prev">
          Hello World
        </a></span> <span class="next"><a href="/weexbox/guide/project.html">
          项目结构
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/weexbox/assets/js/app.7ae12184.js" defer></script><script src="/weexbox/assets/js/2.52705d15.js" defer></script><script src="/weexbox/assets/js/3.9ad135ec.js" defer></script>
  </body>
</html>
