(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{278:function(t,a,s){t.exports=s.p+"assets/img/flutter_0_1.ee8a5253.png"},279:function(t,a,s){t.exports=s.p+"assets/img/flutter_0_2.ff7afca9.png"},280:function(t,a,s){t.exports=s.p+"assets/img/flutter_0_3.f55c0ddc.png"},281:function(t,a,s){t.exports=s.p+"assets/img/flutter_0_4.6e4b8e02.png"},282:function(t,a,s){t.exports=s.p+"assets/img/flutter sdk.c1fffecb.png"},283:function(t,a,s){t.exports=s.p+"assets/img/dart_sdk.fccc1f7f.png"},284:function(t,a,s){t.exports=s.p+"assets/img/flutter1.ab9c5508.png"},285:function(t,a,s){t.exports=s.p+"assets/img/flutter2.3046387b.png"},286:function(t,a,s){t.exports=s.p+"assets/img/routerManage.31e65f74.png"},310:function(t,a,s){"use strict";s.r(a);var e=s(38),n=Object(e.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"flutter-初体验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flutter-初体验","aria-hidden":"true"}},[t._v("#")]),t._v(" Flutter 初体验")]),t._v(" "),e("h2",{attrs:{id:"为何使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为何使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 为何使用")]),t._v(" "),e("h3",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[t._v("针对原生开发面临的问题，人们一直都在努力寻找好的解决方案，时至今日，已经有很多跨平台框架(主要指Android和iOS两个平台)，根据其原理，主要分为三类：")]),t._v(" "),e("ul",[e("li",[t._v("H5+原生（Cordova、Ionic、微信小程序）")]),t._v(" "),e("li",[t._v("JavaScript开发 + 原生渲染 （React Native、Weex）")]),t._v(" "),e("li",[t._v("自绘UI+原生(Flutter)")])]),t._v(" "),e("p",[t._v("针对以上几种跨平台的方案，每个框架都有其优缺点，在我们的项目中，也都曾尝试过，也踩过无数的坑。近期爱收入开发天团初体验了flutter并成功上线，发现了它的美，迫不及待地分享给大家。")]),t._v(" "),e("h3",{attrs:{id:"weex的不足"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#weex的不足","aria-hidden":"true"}},[t._v("#")]),t._v(" weex的不足")]),t._v(" "),e("ul",[e("li",[t._v("学习资料少")])]),t._v(" "),e("blockquote",[e("p",[t._v("Weex 的学习资料比较少。而RN使用的开发者比较多, 社区活跃，围绕react产生了许多开发框架。\n这一点，个人认为是weex最大的缺点，甚至是weex能不能很好发展下去的关键因素.")])]),t._v(" "),e("ul",[e("li",[t._v("社区活跃度不够")])]),t._v(" "),e("blockquote",[e("p",[t._v("Weex 相较于 RN 起步比较晚，Weex目前社区主要由阿里人员在维护, 相较于已经成熟的RN社区目前还有很多不足。用的人相对RN少很多，目前没有形成一个良好的生态。作为开发者，如果碰到一个问题，搜索不到，抛出去也没人很好的解答，自己摸索的成本就会很高了。 可能解决一个问题的成本就已经远远大于节省下来的一点学习成本。")])]),t._v(" "),e("ul",[e("li",[t._v("界面的设配精度不够")])]),t._v(" "),e("blockquote",[e("p",[t._v("Weex进行界面适配的时候是用750为标准的，所以需要根据750去换算，换算的过程中会进行四舍五入，所以会产生精度不足。")])]),t._v(" "),e("ul",[e("li",[t._v("对常用的断点调试支持不足")]),t._v(" "),e("li",[t._v("不支持热重载")]),t._v(" "),e("li",[t._v("官方对于动画的支持非常薄弱")]),t._v(" "),e("li",[t._v("weex每次更新都会出现较严重的设配问题")])]),t._v(" "),e("h3",{attrs:{id:"flutter优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flutter优点","aria-hidden":"true"}},[t._v("#")]),t._v(" Flutter优点")]),t._v(" "),e("ol",[e("li",[t._v("性能强大，流畅")])]),t._v(" "),e("blockquote",[e("p",[t._v("Flutter对比weex和react native相比，性能的强大是有目共睹的。对于weex，react native，主要基于dom树渲染原生组件，很难与直接在原生视图上绘图比肩性能，Google作为一个轮子大厂，直接在两个平台上重写了各自的UIKit，对接到平台底层，减少UI层的多层转换，UI性能可以比肩原生，这个优势在滑动和播放动画时尤为明显。")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("路由设计优秀。")])]),t._v(" "),e("blockquote",[e("p",[t._v("Flutter的路由传值非常方便，push一个路由，会返回一个Future对象（也就是Promise对象），使用await或者.then就可以在目标路由pop，回到当前页面时收到返回值。这个反向传值的设计基本是甩了微信小程序一条街了。弹出dialog等一些操作也是使用的路由方法，几乎不用担心出现传值困难")])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("优秀的动画设计。")])]),t._v(" "),e("blockquote",[e("p",[t._v("Flutter的动画简单到不可思议，动画对象会根据屏幕刷新率每秒产生很多个（一般是60个）浮点数，只需要将一个组件属性通过补间（Tween）关联到动画对象上，Flutter会确保在每一帧渲染正确的组件，从而形成连贯的动画。这种十分暴力的操作在Flutter上却看不到明显的卡顿，这也是Flutter的一个魔力所在。相比之下其他跨平台框架几乎不能设计动画……往往会遭遇非常严重的性能问题。")])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("UI跨平台稳定。")])]),t._v(" "),e("blockquote",[e("p",[t._v("Google直接在两个平台上在底层重写了UIKit，不依赖于Css等外部解释器，几乎不存在UI表达不理想，渲染不正常的情况，可以获得非常稳定的UI表达效果。Css换个浏览器就有不同的表现，基于Css的跨平台框架很难获得稳定的UI表现。")])]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("可选静态的语言，语言特性优秀")])]),t._v(" "),e("blockquote",[e("p",[t._v("Dart是一个静态语言，这也是相对于js的一个优势。Dart可以被编译成js，但是看起来更像java。静态语言可以避免错误，获得更多的编辑器提示词，极大的增加可维护性。很多js库也已经用ts重写了，Vue3.0的底层也将全部使用ts编写，静态语言的优势不言而喻。")])]),t._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[t._v("支持热重载")])]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.jianshu.com/p/c51fc925bfd1",target:"_blank",rel:"noopener noreferrer"}},[t._v("引用地址"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"flutter架构简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flutter架构简介","aria-hidden":"true"}},[t._v("#")]),t._v(" Flutter架构简介")]),t._v(" "),e("ul",[e("li",[t._v("传统的原生开发使用Native语言和Platform进行交互，通过调用平台API来实现App的功能。")])]),t._v(" "),e("img",{attrs:{src:s(278)}}),t._v(" "),e("ul",[e("li",[t._v("RN通过JS访问平台UI组件，所以需要通过Bridge桥接器将JS转换到原生，在UI被频繁操作时可能导致性能问题。")])]),t._v(" "),e("img",{attrs:{src:s(279)}}),t._v(" "),e("ul",[e("li",[t._v("为避免JS桥接器的性能问题，Flutter采用Dart语言，Dart使用预编译的方式编译多个平台的原生代码，这允许Flutter直接与平台通信，而不需要通过执行上下文切换的JS桥接器。Flutter的UI组件和渲染器都从平台中移到了到用户的应用程序，所以虚拟机中的控件树是真实的控件树，渲染速度快。Dart程序和执行数据编解码的平台之间仍然有个接口，但这个接口的速度比JSBridge高出几个数量级。")])]),t._v(" "),e("img",{attrs:{src:s(280)}}),t._v(" "),e("ul",[e("li",[t._v("绘制原理")])]),t._v(" "),e("blockquote",[e("p",[t._v("我们都知道显示器以固定的频率刷新，比如 iPhone的 60Hz、iPad Pro的 120Hz。当一帧图像绘制完毕后准备绘制下一帧时，显示器会发出一个垂直同步信号（VSync），所以 60Hz的屏幕就会一秒内发出 60次这样的信号。 并且一般地来说，计算机系统中，CPU、GPU和显示器以一种特定的方式协作：CPU将计算好的显示内容提交给 GPU，GPU渲染后放入帧缓冲区，然后视频控制器按照 VSync信号从帧缓冲区取帧数据传递给显示器显示。\n所以，Android、iOS的 App在显示 UI时是如此，Flutter也不例外，也遵循了这种模式。所以从这里可以看出 Flutter和 React-Native之众的本质区别：React-Native之类只是扩展调用 OEM组件，而 Flutter是自己渲染。 在 Flutter Architecture的解释中，Google还提供了一张更为详尽的图来解释 Flutter的原理：")])]),t._v(" "),e("img",{attrs:{src:s(281)}}),t._v(" "),e("blockquote",[e("p",[t._v("这张图解释得更清晰一些：Flutter只关心向 GPU提供视图数据，GPU的 VSync信号同步到 UI线程，UI线程使用 Dart来构建抽象的视图结构，这份数据结构在 GPU线程进行图层合成，视图数据提供给 Skia引擎渲染为 GPU数据，这些数据通过 OpenGL或者 Vulkan提供给 GPU。\n所以 Flutter并不关心显示器、视频控制器以及 GPU具体工作，它只关心 GPU发出的 VSync信号，尽可能快地在两个 VSync信号之间计算并合成视图数据，并且把数据提供给 GPU。")])]),t._v(" "),e("h3",{attrs:{id:"各框架特点汇总"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#各框架特点汇总","aria-hidden":"true"}},[t._v("#")]),t._v(" 各框架特点汇总")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("比较内容")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("React Native")]),t._v(" "),e("th",{staticStyle:{"text-align":"right"}},[t._v("Weex")]),t._v(" "),e("th",{staticStyle:{"text-align":"right"}},[t._v("Flutter")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("平台实现")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("JavaScript")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("JavaScript")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("无桥接、原生编码")])]),t._v(" "),e("tr",[e("td",[t._v("引擎")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("JS V8")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("JSCore")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("Flutter engine")])]),t._v(" "),e("tr",[e("td",[t._v("核心语言")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("React")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("Vue")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("Dart")])]),t._v(" "),e("tr",[e("td",[t._v("Apk大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("7.6M")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("10.6M")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("8.1M")])]),t._v(" "),e("tr",[e("td",[t._v("bundle文件大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("默认单一，较大")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("较小，多页面可多文件")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("一般")])]),t._v(" "),e("tr",[e("td",[t._v("上手难度")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("稍高")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("容易")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("一般")])]),t._v(" "),e("tr",[e("td",[t._v("架构程度")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("较重")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("较轻")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("重")])]),t._v(" "),e("tr",[e("td",[t._v("特点")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("适合开发整体App")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("适合单页面")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("适合开发整体App")])]),t._v(" "),e("tr",[e("td",[t._v("社区")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("丰富，facebook重点维护")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("有点残念，托管apache")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("刚出道的小鲜肉，拥护者众多")])]),t._v(" "),e("tr",[e("td",[t._v("支持")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("Android,iOS")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("Android,iOS")]),t._v(" "),e("td",{staticStyle:{"text-align":"right"}},[t._v("Android,iOS,web?")])])])]),t._v(" "),e("h2",{attrs:{id:"weexbox中使用flutter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#weexbox中使用flutter","aria-hidden":"true"}},[t._v("#")]),t._v(" WeexBox中使用flutter")]),t._v(" "),e("h3",{attrs:{id:"安装环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装环境","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装环境")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://flutter.dev/docs/get-started/install",target:"_blank",rel:"noopener noreferrer"}},[t._v("flutter SDK安装"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("根据flutter官网配置环境变量")])]),t._v(" "),e("h3",{attrs:{id:"创建项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建项目")]),t._v(" "),e("ul",[e("li",[t._v("weexBox可以通过命令行创建包含weex与flutter的混合项目：")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建一个weex和flutter混合工程")]),t._v("\nweexbox create project-name -f\n")])])]),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v("flutter章节是基于Android studio开发环境所写")])]),t._v(" "),e("h3",{attrs:{id:"运行项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 运行项目")]),t._v(" "),e("p",[t._v("运行项目之前，需要先用Android Studio打开flutter_module项目，该项目在platforms文件夹下，与Android、ios项目同级。因为原生项目需要将flutter文件打包到apk里面，需要先确保flutter项目环境没有问题。打开flutter_module项目后配置好flutter与dart安装路径，如下图：")]),t._v(" "),e("ul",[e("li",[t._v("flutter sdk\n"),e("img",{attrs:{src:s(282)}})]),t._v(" "),e("li",[t._v("dart sdk\n"),e("img",{attrs:{src:s(283)}}),t._v("\n然后同步环境后运行该项目，编译一段时间后，生成apk成功（注意apk生成成功，不成功说明你的flutter环境有问题，请检查是否缺少了某个步骤），安装apk成功后，打开apk，Console将会报错，因为该flutter项目并不是一个纯项目，而是我们原生项目的一个依赖。接下来就可以直接运行原生项目。")]),t._v(" "),e("li",[t._v("项目结构\n"),e("table",[e("thead",[e("tr",[e("th",[t._v("目录与文件")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("android")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("flutter与Android工程相关")])]),t._v(" "),e("tr",[e("td",[t._v("ios")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("flutter与iOS工程相关")])]),t._v(" "),e("tr",[e("td",[t._v("lib")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("flutter核心代码")])]),t._v(" "),e("tr",[e("td",[t._v("pubspec.yaml")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("flutter依赖的配置文件")])])])])])]),t._v(" "),e("img",{attrs:{src:s(284)}}),t._v(" "),e("ul",[e("li",[t._v("配置文件 pubspec.yaml")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("version"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 环境，flutter的sdk版本在此之间")]),t._v("\nenvironment"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('">=2.2.2 <3.0.0"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 依赖库  ")]),t._v("\ndependencies"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  flutter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flutter\n  cupertino_icons"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),t._v("\n  flutter_spinkit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^3.1.0"')]),t._v("\n  flutter_easyrefresh"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".7")]),t._v("\n  common_utils"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 测试环境的依赖库")]),t._v("\ndev_dependencies"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  flutter_test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flutter\nflutter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  uses"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("material"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("design"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 图片配置 weexbox refimg / weexbox refimg -d (自动创建基于配置信息的dart文件) 已实现自动导入图片配置")]),t._v("\n  assets"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" images"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("icon_expert_help_1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("png\n     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" images"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("icon_expert_help_2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("png\n     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" images"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("icon_expert_help_3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("png\n")])])]),e("h2",{attrs:{id:"原生通信"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原生通信","aria-hidden":"true"}},[t._v("#")]),t._v(" 原生通信")]),t._v(" "),e("ul",[e("li",[t._v("对于某些需要调用原生硬件的需求，flutter不可避免的需要和原生端进行通信，flutter提供了3种通信通道。在weexbox中，已经写好了通信通道，并且根据不同情况选好不同的通道。")]),t._v(" "),e("li",[t._v("核心类\n"),e("table",[e("thead",[e("tr",[e("th",[t._v("类名")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("BasicMessageChannel")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("用于传递数据。Flutter与原生项目的资源是不共享的，可以通过BasicMessageChannel来获取Native项目的图标等资源。")])]),t._v(" "),e("tr",[e("td",[t._v("MethodChannel")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("传递方法调用。Flutter主动调用Native的方法，并获取相应的返回值。比如获取系统电量，发起Toast等调用系统API，可以通过这个来完成。")])]),t._v(" "),e("tr",[e("td",[t._v("EventChannel")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("传递事件。这里是Native将事件通知到Flutter。比如Flutter需要监听网络情况，这时候MethodChannel就无法胜任这个需求了。EventChannel可以将Flutter的一个监听交给Native，Native去做网络广播的监听，当收到广播后借助EventChannel调用Flutter注册的监听，完成对Flutter的事件通知")])])])])])]),t._v(" "),e("h3",{attrs:{id:"flutter调用原生提供的方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flutter调用原生提供的方法","aria-hidden":"true"}},[t._v("#")]),t._v(" flutter调用原生提供的方法")]),t._v(" "),e("p",[t._v("需要原生端先提供方法的实现，再在flutter进行调用。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("原生提供方法")]),t._v(" "),e("p",[t._v("建议使用者在继承WBFlutterActivity的基类Activity中重写以下方法，或者在WBFlutterActivity中直接修改。")])])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子类重载此方法，就可以添加自己的method")]),t._v("\n    open fun "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("flutterMethodCall")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MethodCall"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MethodChannel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Result")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        val method "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method\n        val arguments "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arguments "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" Map"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Any"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TreeMap"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Any"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("when")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"methodName"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                result"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[t._v("flutter调用原生方法")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("ChannelManger"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("methodChannel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeMethod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'methodName'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//methodName是与原生端一起定好的方法名")]),t._v("\n")])])]),e("h2",{attrs:{id:"weexbox通信"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#weexbox通信","aria-hidden":"true"}},[t._v("#")]),t._v(" WeexBox通信")]),t._v(" "),e("p",[t._v("由于weexBox中使用了weex与flutter，为了统一weex，flutter，native三端的通信，我们提供了以下解决方案。\n"),e("img",{attrs:{src:s(285)}})]),t._v(" "),e("ul",[e("li",[e("p",[t._v("路由的跳转\n在weexBox中跳转flutter界面同样采用路由的方式，并且与原来的路由跳转没有区别，只需要将router.name改为flutter，url传入flutter模块中定好的flutter路径。")])]),t._v(" "),e("li",[e("p",[t._v("先在RouterManager定义flutter路径\n"),e("img",{attrs:{src:s(286)}})])]),t._v(" "),e("li",[e("p",[t._v("flutter页面跳转flutter")])])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" router "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Router")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nameFlutter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//Router.nameFlutter = "flutter"')]),t._v("\n  router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_fade_app'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sss'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sss'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarHidden "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("ul",[e("li",[t._v("weex页面跳转flutter")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("native"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'flutter'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 隐藏导航栏")]),t._v("\n  navBarHidden"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_fade_app'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'modify'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("ul",[e("li",[t._v("事件通知\nweexbox中的flutter、weex和native都支持全局事件通知， 任一端注册事件，任一端发送事件。下面是flutter的注册事件和发送事件，weex的事件注册与通知请查看weex章节。")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送事件")]),t._v("\nEvent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eventName'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vbbbb'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册事件")]),t._v("\nEvent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eventName'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//print(event); ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注销事件")]),t._v("\nEvent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("unregister")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eventName"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注销当前页面全部事件")]),t._v("\nEvent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("unregisterAll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},[],!1,null,null,null);a.default=n.exports}}]);